pragma solidity 0.8.14;
pragma experimental ABIEncoderV2;

import "forge-std/Vm.sol";
import "forge-std/console.sol";
import "forge-std/Test.sol";
import "./LightClientMock.sol";
import "src/amb/TargetAMB.sol";
import "src/lightclient/libraries/SimpleSerialize.sol";

contract TargetAMBTest is Test {
    LightClientMock lc;
    TargetAMB amb;

    function setUp() public {
        lc = new LightClientMock();
        address lightClientAddress = address(lc);
        address sourceAMBAddress = 0x42793dF05c085187E20aa99104A4E67e21823880;
        amb = new TargetAMB(
            lightClientAddress,
            sourceAMBAddress
        );
        vm.chainId(100);
    }

    function testExecuteMessage() public {
        uint64 sourceSlot = 7725990;
        bytes32 executionRoot = bytes32(
            0xcb7cd7e3d6fcb9ed019eec76dd8483a7732e5e83b598586afd1308ba1ad9e962
        );
        lc.setExecutionRoot(sourceSlot, executionRoot);

        bytes[] memory accountProof = new bytes[](8);
        accountProof[0] = hex"f90211a0bd22c40d470b1116c36202a184436aa5aab6c00ca1a961900e8e802a71ebc016a0640b6be0b038321db7adb2788ac8d2afa9b82644d1323e9a690a8c8905c84b81a09685b78246e3c4fb28fee6887b05721dd3efeec51e992c0c6cf3ff679ea67659a07cdfb02afbfb361cdcc5cba88e0a773257fac4e477aa08515eb0e7e1700e2acfa0e9efd828dcee422dff33bd46e6364e8dc8aa5af0b76b17c63c40d115f52dfae3a0cfb1e72c4e93b2eeba55cd6564eb7f6c559bbf4c954a389e672ff09c79ffc481a07f2ee1c2c4667331edf0dd1ab8690a881bbd6d68353693abd9bc55938e95cd72a054907b454ef211ed5adf3203a9aa2a9c849ca4baaf58b8f2334648505fba692ca08c93fbe97344f0cf47249647ff7beabfec348061f2c5db8b06b9c6a13cac101ea0abd596736f9913747b2a69f225722d18908dfed5f9419d387dbf0cd3bb3bddaaa0f27a021fb25be936a98a223f3bec33d5a140a74c5f2964b27a62a356f3d3e276a0cec4e89b4dfaf8b154b417e867c3643bb2afb8db60efbdddb0c20f3a840680daa03948666abaa305cb7626aa2c7aa7eb94542397f90f1da9efdbd1ffdbecabff71a0f07a043deea9261111b3a52a447cbbba793bdcea0120e71cd3d41773d7184bcda0b9037b5bbf47b313ce0b1c7fc9cd6f7301ee294afad112d44fc74ed7f868ade6a069c9e1d7fddbace686fce8c137e6bbed47ec66f63744e29d18623ffe60aa556b80";
        accountProof[1] = hex"f90211a0eb8689a3af3d3605b0c4d84c938b6c3203689b6134638f72b61cefcaa4de754ea0ed7d0c3edc6c617ea7af84fb656a50b0fbd1fcaf7b53cbb9d5ffdf5709776204a0b6de9b4840d4664aaa0f732f625c8385d485486d5e670fbc1155ec76d69528bca05cd9120ea2694c7d4fe2da43b2fb8377b25778905b5f3d807b885a3521b1a842a05223f018434c4cc725bebc30f93966b2a98392761356fbb99b886f861a632e17a0bdeb5d6958e4a32f819bea257a88af52e66cf8baff573981a916185f9e8f628aa0e0d36008579e4cb8a3de0cfdf388342028c60fd0cfaba41b61a8db96024dd1dba04d353c936a99c43465149b861e0a30cb2c08f2ecb313e7ac645d00fa2b695a1ea0bddcbb4bf6d5b9b3537233cb226157bbdce7d81578f42f228817d925fbe5d1e0a0d419390bdcd6299ffabf3a9c0ed7578049edb83ed700b9889db15a9aa1138708a07ea1ad8c9bcfc39d81370fac138a6c7377024c7f50ffdfbb3d841f018312aed8a03bbc52e2af4c9debb3a111be91443088230df2d8a85c937e6846e20de5ca2ddba07fcc52ac80657a319abb49b884cb684ece2e5df75e246d003688528b50c70754a0dad344da7363136cdc4a6c288e9813de3366ebefbee6b45c4376ca0f2ca1bb02a003d38d3dd3e9a1abd92bc690d395137c9126a4ccf147299fe98037c3fd2d8189a07f4c223d0e3dc8a7e3f7a25495bf658f845f3248db2cbc3297219c47e21aaeae80";
        accountProof[2] = hex"f90211a01d1d1a069a7d945cdd59b5d534007b86a0bf442e0b84db821f6a08b9aff50297a02ceea5fdcaef6fe30e23111547e76d23000c2fe61e75a1f49beb6c1b4490d6dca01dc05def808c9c9c817224b23f6501cc7bb3697d2583e4051949e7269198ca6fa09ae840e91873b2261baa0b2a2d22387c6dee64d67a8a33683159b04dcf7f0e79a02923b6ad6afbbf978fa0fd4c9506468ff17842555cf512dd024261b7c4479fd9a0dcefd73d55a4df5bfc6e57b0a14a81d28f691ddb04d8030cbb0fdafc3001406ea088ac07d43f386f3cbd5d7d75ea3e39ef0e9c2d6f37f1d5c9e8b53265bbe9e8fea0b87931ada8c2471a753e2fe8fb8a17a91ab909e52727dcb51a9b70dfb49ed61ca053146e4d5255a14304d7da96cc73aafaa17e675924429ecfa9e3923fc5f0dac2a07a3015774a754be07b396ed971e8b62f1c394adcfddc308ebeb5ef5c35c0de9ba06ab1086ac83c887424d9395c5189520079e09b06bca1a20a8d235b69bb5ce703a09108da53cf102a54091d6f7d7630670d6d41b45caab688201ec48e7b7d40e82da0323015275bcd6a518389c0bb213bf4b81a3516ce2748f49bf98c06987ab314d6a051e41dd6fc1986171f4b625976868b36035b676b0e4ca485828cc92654846001a0702d0f459df4ecf92ad5c3be48757a7c86b1b4f09ccdffa20ecc0b3ab58a5024a056a909d7910f39ef0f1286f892988d56e35da9de9a27b588c105034f48c7d0c080";
        accountProof[3] = hex"f90211a0ba3bffbeac1d5f4ce36380494c7eaf06b54a96339b3ceb2178e0809d95460e6ea011612f67916d31b0c77c307395dd038d61c8617f1537df55c9f60819fa122422a01bb3d4e8106be4e549a28c1ca7b7c38e3ead19b14a2e884f72fae35437f98947a0258c7a55a4c628321ede483cd81bdcd1a86ceb87409da94fa626eae75b81babfa071523970a72203b1415f091610354bee24568050c3479d1cd84d3f79cb635fe5a0536ba529ca0822928624371ce6574cd7f80607000df51e5bf58acbdb5d964c5ba070351fee868445dc321a1148879225173e5a0e298aa7cb010ed4aead2cf4c7e0a0837dc8f363b0cd15a3b1602584763767807bdf101e20f624b64454281cdbfc5ca014d73b8a30b13409ff9bbf139e7e3affd87df0ab0dbdff0d3b0e0a7c2e90132ea0ed4a533f3f5adb1c67515b7b990dcbe644819e5f0f097c8b8765d2152a2f14ffa071af248c6244c198010f0772d8d50cbbd00617abebf711393cc50e5ded3fd467a000205353c44ca8fd5cc79715e9270ffb543a30af76a0897083c5a9282597a5e8a0302b41a82e169dbe0cf9830358f676128b62e86040641d123f702a57c60f25e3a07dd5ab6584de223c1677ad440d2938050dd68bf33735c9b3479b206830d7ce5aa05c09779cdccb26244d91fc236a323002f69e13210ef3fe7a87fac854f700a9e7a0ca3b34416c4e45ca98fc458af20d2fbf64d4a3e77e937527e3f9ecdf080138e880";
        accountProof[4] = hex"f90211a0537c80d01107b3b8d77c8af13a1aa4977abb5e9432b1e9577b7944ebcb4789b8a03018e9c68f82f2e3e15d7025c36040b59b748641c756e61aa5b707667b4c198ca05490a3c1985b360e81142b9c37c2509d59a8f54fe83f1f62fa3bfe43f1b0e9d3a097425808ba81e3a5bae5af914a3dccff544a8155df31fc975cf4bd305b7e7057a0dd0b1cf013e29fc9308dedff649cb41ffc70aa2aad4f686d697a3fa47cd689cba087ca7df614c0d893d7415130caf3a759b9a3b53a43886e9e488fa9b6c3e575cda09f3138074a674909960c8b6e8a8b64e1a8a2ac294300420bced4dc9008ec4f5da081c19a27e5545118e117cf5375962d7540069b5aa0979655c245a7cf0335dfa6a0e219f7c32fedd932df671dec044efebb04add184a02f636d11528c5ed0960965a051307864184a9b66a7a6888bd2d45dd048ccc6db4a55c6ceedeb4c6bc6cc44bfa00e8c4f9db5a78b8d21b9c97b4afc1c046b63bd5160a08a9aa86f34787db40bb4a00afc75cd5407aeddd084210d94c79d9e8d0752aa9c56ea74c22a3a68f61b3a05a0d0417601a2b7c719bfa1ac4ee5521073e18ee4b0ee0bbf6a7dbc96b4a9994705a09174f245d3ab8f9d18db908319ab3c6b762248287c65648da01164a7a8c00592a023e8196f81d5aed4a40d5e24599816a5a19feae103df5a566b1e66ba631755c7a07b18d7e2bee75214816b93497ab684acce1c9a7fe697fcb56eaddc15c85b6baf80";
        accountProof[5] = hex"f9015180a0b3ce95094b35aea747c8190a13462aea43255e4d08a952988f1d97628581efca80a0660135ecdbcbdf53a2198f0333d326bf2fb17960a6000557b227f459f81bfe0380a031b9dcbbcad33c01020599911c1ed757ab6b0d49228a4459bbfa94d80339060da044734df82ae270d87af981475fd23837dabb28a7879739c2f85d924028eee3d080a04da1ed2cf045a616ecaf43ef30bcf419994797bb215a17ff028e23fe2fc9e15ca0b3d8573a66233c6ae754ba61d280f4fc3687c2bdec9fc1735432d5d5cc2d5722a08e6fce89d24ffb3895de7f818d818e10ec056ff6d48e0ad25d3c8a165f1c5d4780a07588e634077653f50807b19f480f04fc85378ed2f4e7f30b00fad2bc8bfd16de80a0bbc62cfd324a6ed22e9c1157079eb6fae88147a5acd3424713380aac12e6f1cba0b8f56f816bcd4e1298d645629b47e4a908eef87ec0e81aee8e90b97e56d3a59080";
        accountProof[6] = hex"f851a05b81664230936d2dba284dd9e92270c0b8d877ae8d7636dbba95853c6ac301628080808080a09d6a2409cb5e9c2f88037f1e8da7e2e21bfa53d9f6b8d0111a17779b294d140880808080808080808080";
        accountProof[7] = hex"f8669d350a94beda7ef9dafcd2ff222f56afcfc32798df80e8cde4c41ee51569b846f8440180a050fc79aaf670adf9f0adff6a553fac0b733151c49fd644fef58b9e9fcfcd86caa082007db7125c87eb6d034ec37046d93a249333dfef349c8ee9b32c60e4999740";

        bytes[] memory storageProof = new bytes[](3);
        storageProof[0] = hex"f8d1a08857639e3944eefb53fc927fd82a371bd6fd6ada8f9fe9cbc2b6381c1aeb5fec808080a09d1bdeb37df185163f327bdb0f417cf2647a05e7039606f486f40acd85e12c3f808080a0604ee4f06b8ea3035e3dcf6528c50e5031f173dbb4bea06460aba082b25d47cb80a064a645f9186d0cd20a1085d7cfc14e82854de25ea3791f659e525cf55c90b88a80a0c04710f5601e4c5dcca343d823f7b00f3fc13d1463a7b4df32dbefdfe1e92c9d8080a0efcbf394e6c7ccec055497aa56de0120b5cc293360a816def7d92183849ab3dd80";
        storageProof[1] = hex"f871a0aa52a12c3844bbac64e5555ae459dc59670a9699510aa43a59f11d066cf43de58080a0ac90845931326be2b79fbc687313c008be30b37e70a74583ff4bfc1703c08d7e8080a0199a703f1f0840573ca4690656c439076a2da9e34462724db6a7d6ba66e2a10d80808080808080808080";
        storageProof[2] = hex"f843a020df3dcda05b4fbd9c655cde3d5ceb211e019e72ec816e127a59e7195f2cd7f5a1a058eb5267effef0b3d1ebbb7839c3a52db33dec8bd32116e22c9d65ed7df5a2e1";

        bytes memory message = hex"00000000000000000000000000000000000000000000000000000000000000000000000000000000000000006e57b45b57e84c964e7cdff596ed02e0387d617e000000000000000000000000efc56627233b02ea95bae7e19f648d7dcd5bb1320000000000000000000000000000000000000000000000000000000000000064000000000000000000000000000000000000000000000000000000000000c35000000000000000000000000000000000000000000000000000000000000000c000000000000000000000000000000000000000000000000000000000000000600000000000000000000000005b73c5498c1e3b4dba84de0f1833c4a029d9051900000000000000000000000000000000000000000000000000000000000000640000000000000000000000000b7108e278c2e77e4e4f5c93d9e5e9a11ac837fc";

        amb.executeMessage(sourceSlot, message, accountProof, storageProof);
    }

    function testReceiptRootProof() public {
        // This tests the receipt root proof against a beacon state root.
        // This tests the case where txSlot and srcSlot are within SLOTS_PER_HISTORICAL_ROOT
        // of each other.
        // The function costs 38k gas.
        bytes32 srcSlotStateRoot = 0x8a971d2c00794efcb266732a1fcf91ae69b78b60d97918e0ba13fe086ac0c68b;
        bytes32[] memory targetSlotStateRootBranch = new bytes32[](27);
        targetSlotStateRootBranch[0] = 0x3c1922a5ea241463bfacfa6e4c55dc63ee235b706cbd972bd549fb5a35211443;
        targetSlotStateRootBranch[1] = 0x58824c5477a7944fb347e955b5f160fd5b9e4578dc3869a8f2faa763bb2f280a;
        targetSlotStateRootBranch[2] = 0xb4ef22a350546b78e23c5b4eb62612a5bbade9edd0952961766abf704f22867e;
        targetSlotStateRootBranch[3] = 0xf461bf759330c4b87849369839057ac181d8f16056e94af94b083ec370c6bd29;
        targetSlotStateRootBranch[4] = 0x0000000000000000000000000000000000000000000000000000000000000000;
        targetSlotStateRootBranch[5] = 0xf5a5fd42d16a20302798ef6ed309979b43003d2320d9f0e8ea9831a92759fb4b;
        targetSlotStateRootBranch[6] = 0xdb56114e00fdd4c1f85c892bf35ac9a89289aaecb1ebd0a96cde606a748b5d71;
        targetSlotStateRootBranch[7] = 0xf4ba75b3557546db48af6a65a4d9c85caae9ed1ed49a2e8e0dc8b5ee16bb6c19;
        targetSlotStateRootBranch[8] = 0x5bc6c323360ba17bab7bc008e42f3b724fdc42a0ecaaca350f7ed9996c7bd2e7;
        targetSlotStateRootBranch[9] = 0xb4ac9b73fea5606f0d6af8202660b0435f88ddd7546f1a4d625a72844250babf;
        targetSlotStateRootBranch[10] = 0x268eba359db6b7a392ef915f3cde9523d533e47efe855258e553121d6f431a18;
        targetSlotStateRootBranch[11] = 0xf374b7407f90e62c78049acb7780d00b4e0728705f1c99bff9ab0f2247bd4f79;
        targetSlotStateRootBranch[12] = 0x889acf0e17b3690d46d8a42b882464fd3a30ff546f5fa6379e1518242fc206ca;
        targetSlotStateRootBranch[13] = 0x387f59eb20a5e1294a65966f944f8c98af497c3d6d77cb5dd0a4973c7b2ed77c;
        targetSlotStateRootBranch[14] = 0x1bd9c412705fd1c99931860d2c23233c6e3775cdbac91ff93c235453267fb732;
        targetSlotStateRootBranch[15] = 0xc596ac89cdd28ba7680b78d53bf4f9edc68dcb1ca1e2854367c1d2db298aa85b;
        targetSlotStateRootBranch[16] = 0x21708bd1258c86451ff99644563018000914da5864639c27c917d1aaee968495;
        targetSlotStateRootBranch[17] = 0xb2d69c5d06778817eb49469fea28edc748ea80ca59309495b2f6ff4e5f07290a;
        targetSlotStateRootBranch[18] = 0x4c7668e400558472d0ee6e8897355ce48c11e6646bdc9097e0ef77dc21f2d358;
        targetSlotStateRootBranch[19] = 0x1d74928552a0db9fed3a5344e0655ab6ba422f12fe95cca98a28d3943b8aee23;
        targetSlotStateRootBranch[20] = 0xa7907a1807ae753e86f018b8096ec68d86b6baf098e1347b2beb7e2cc40cb7ef;
        targetSlotStateRootBranch[21] = 0xcaa0c0d466c382afb754a047d6f8a01420df3f166cef655b43743ad758e33281;
        targetSlotStateRootBranch[22] = 0xc171a2c57d669c2e10eec7af1b8fbbc2da7f518499f90aa2346adb4d84b7e8c7;
        targetSlotStateRootBranch[23] = 0x6a98e7cb86041c8bfef8409a2b0b0687e50e3d5d51ec70d06522578a8bc5d9c4;
        targetSlotStateRootBranch[24] = 0x7a10ae15a283982b2366bf1cc5574a7bbb8ec7b6f724f18537223c8ec1524f08;
        targetSlotStateRootBranch[25] = 0xa788a54ef7abad6ad9188bbca48754dffee3eb19d4de1a083c1324ab24279b52;
        targetSlotStateRootBranch[26] = 0xef9e4f1156c85ace4f2cc7a73029501f0d33ace011b8d1fcb13103ea9acc8475;
        bytes32 receiptsRoot = 0x05911bffdb32343df6d8af53971ade6b8959e1b06ad994715a8080524a2875d2;
        uint concatGindex = 162103683;
        bool isValid = SSZ.isValidMerkleBranch(receiptsRoot, concatGindex, targetSlotStateRootBranch, srcSlotStateRoot);
        require(isValid, "Invalid state root");
    }

    function testExecuteMessageFromLog() public {
        // This is for transaction 
        // https://goerli.etherscan.io/tx/0x29f2d00f672cfca2ba47d64bae25a5e3c22c964027d7da53d94fc0232b9fee32
        vm.chainId(10);
        uint64 sourceSlot = 4359434;
        bytes32 stateRoot = bytes32(
            0x7ee9e190b18bbcdf69c5cf923c08ed1d891ad4b92f993bd4bc05cf7a22bf7c64
        );
        lc.setHeader(sourceSlot, stateRoot);
        // We want to use a new targetAMB here with a new srcAMB address
        TargetAMB targetAmb = new TargetAMB(
            address(lc),
            0x9FAC335A6C905346FEb37E679a34b7A8C61A44B1
        );

        uint64 targetSlot = 4359319;
        bytes memory srcSlotTxSlotPack = abi.encode(sourceSlot, targetSlot);

        bytes32[] memory receiptsRootProof = new bytes32[](27);
        receiptsRootProof[0] = 0xb49fcf4424b3011c58125457a9981fb4d9d83d6372335803976c639caa5b4928;
        receiptsRootProof[1] = 0x91fde5c543814c24125decbd109083844eec89e065c6a02179a7c8a4d9d60d18;
        receiptsRootProof[2] = 0x84e780b5256f1c09a011459549c3456bd2ae44451adcb19c5f51d85c34451e3b;
        receiptsRootProof[3] = 0xa576a07fc2e9d9092b6c1eb29aa053d552293b390e7639d0e69827c767d60604;
        receiptsRootProof[4] = 0x0000000000000000000000000000000000000000000000000000000000000000;
        receiptsRootProof[5] = 0xf5a5fd42d16a20302798ef6ed309979b43003d2320d9f0e8ea9831a92759fb4b;
        receiptsRootProof[6] = 0xdb56114e00fdd4c1f85c892bf35ac9a89289aaecb1ebd0a96cde606a748b5d71;
        receiptsRootProof[7] = 0x18256aad9d5981921fa684778ae1ec687fc9239b936801b07fb0dc09f4054c4d;
        receiptsRootProof[8] = 0x74ff037cec48ce41fe17bc2e4469e023d4e207522c23c756a4318bb74108a092;
        receiptsRootProof[9] = 0xaadcdc3a87a572e43970562952c792c236fe5fbbe38666bf0b968f749e1dc03a;
        receiptsRootProof[10] = 0x33e992a750976afbc403122296b21b52b025dd65edfef67b5514549fd6f97405;
        receiptsRootProof[11] = 0x7caa51cc5f884abcd79d70634f42e6e4e6a9a50106b54b649861b1a85a430720;
        receiptsRootProof[12] = 0xe43df2f96d36d1d44cee2de6b16bcc31b3ff1d7aaf0027c6766c8f07535ae469;
        receiptsRootProof[13] = 0xc825e6a064a09b8159b05ce47f09e5555d71b690ad8f47a7c587b1f0241ab1f6;
        receiptsRootProof[14] = 0x99e9f25cdfc3320034f433b536345c68c69a5b6e0cac9cb9b9ea85eef2d7a86e;
        receiptsRootProof[15] = 0x8c4eeea26a67c2f328f22007599e6fb94f96ee719745229bf9c148f36faf8a70;
        receiptsRootProof[16] = 0xdc6bad2725407c3d1be981c2237ac38c9a5fd03b83a9e2e8f07df667f1003836;
        receiptsRootProof[17] = 0x5dc6ee14fe740c0eb23f0ff5fcdc052ec8550b561a3c709db53e69f4b40269c9;
        receiptsRootProof[18] = 0x33e2d3eb99f759a7a2407f2453331f97e20e11ee71b24e59a510094a585edee8;
        receiptsRootProof[19] = 0xa98d07e323ca982a667c4eb35ef3d5c63df0b2c444c69bbbf14884541024e6ab;
        receiptsRootProof[20] = 0x6bba545bb217439227a6c47992710da5b69077ede313ec5dfedcb23d55fc7852;
        receiptsRootProof[21] = 0x85c95ded65e47ba30954ff1949e4ea5dc0df53b2477da29d2dc6ff357f15b7d6;
        receiptsRootProof[22] = 0xdf56dce5a86efca896ca62251898e8cc20444ed333ec13a1758581897cbb8a90;
        receiptsRootProof[23] = 0xf12bf2483c9539301c395511e92e798e464e94703c3b77bc23c9749e7a2a78a7;
        receiptsRootProof[24] = 0x972f8a8e496559da008a0edfac4053fca8fcc37202d90fd5b09c908529de09b2;
        receiptsRootProof[25] = 0x10034b7d9039ade30b90082d9723cec303969d3d197b9989c3e357ff171a8d82;
        receiptsRootProof[26] = 0x325509be92d489e86c094ea2e39ec192e8e4c7ae672ffb39fc9c3a670cffc8c5;
        bytes32 receiptsRoot = 0x35c3509d3520db16370024a4f3ea3faa5210fe73c1ebcada9f70006bf29592b4;
        bytes[] memory receiptsProof = new bytes[](3);
        receiptsProof[0] = hex'f8d1a0a9b5e791d1636d13ebaf8a4bd803ccdc62428c65aa720db3c254ba4841b922aba0ca56889f6e908c6a283a95bc9d9e8edafd8a7193f7b014c20af3261d2dddd508a0efa41ed9e4677058d2e4e849e22b9331f2756a860f276aa402faf0c6825611fca064d69ab1c91219dc613f229755498e7cdf2ceed08d30f2b93c3b00d3e5877c7ea0a2a0f42d33e76b544c1f4d65a3f9938fc925e3cfad3876cc87ea7ba962e69096808080a0e58215be848c1293dd381210359d84485553000a82b67410406d183b42adbbdd8080808080808080';
        receiptsProof[1] = hex'f90211a0e31de284966365cc1a21555250cf02364b0d1784feb4e7d3d9e1afc123485493a0ba6b0cc12653762889a8bf364523266e977876b8cb1c27e7dbc29778d545928ba052c83c0ce70d0b51865426f261f7801dc545c72802da0af78bd915298d40420da06148ab84431bc63231921d9ad4507f4ad5f7aaffa0f178536f55c95f58946673a023828c1e49ecdbb76261d065c6b6c8a0fc787e02484217067c11a9ae87effa15a0d85f7d12cf61c4cf1684f4632bf55722746ad04824cd464db0a42b8890c4d8a7a079477d4a2cbfa5a92d02bac293b08ce0d6c99712472af188f6eb4b2e347edcb1a0a19eaa4fa5ee24b8e57111e6d2c2a27dac8b214a5103c23f2586ebb3ca67b528a0e3d60cb6c7ef84e674e3d6f97f9ca6f2e341ae09a255762272f84fe1c8863031a05b776f11d256c1076ffcc80a29d507fdc08d281bca80a55107407fabd7aa5aaca0278d8c61b0cdd6a7f638da345b0aaa01e966efebce0a3970305e04f363d810c4a097cd9f32de05dc6ad22bfd5f91027ced78b2da27c33663eb7b613318bf81f45aa05dc538a83faddf36fb3a56dfada8db56afd36c014a6847ea876786bcadca74afa0c00527a625fb965d8e89d96d73a1578e409262eb1e8e7fbd5f712a44f1847c75a0db81b35e65873d6517d4fd305bcb377b8fce818718b2b4f8d61263ba55a3b3e9a045057075f11468500ffb11cca9dacfcadfaa995df8b0b507574a03303f5e8bd080';
        receiptsProof[2] = hex'f9035020b9034c02f903480183300999b9010000000000000000000000004000000000000002000000000000000000000000000000800000000200000000000000000020000040040000000020000000000000000000001000000000080000000000000000000000000000000000000000080040000000000000000000000000000000000000000000000000000000000040000000000000000000010000000000000000001000000000000000000000000000000000000004000080000000000000000000000000000000000000000000040000000000000000000000000000000000002000000000000084000000000000200000000000000000000000000100000000000000000000040000000000000000f9023df901bd949fac335a6c905346feb37e679a34b7a8c61a44b1f863a069fba49bf5354b0f1c560ef32d7525874d05e65452e997b5556a9dedb5d7576fa0000000000000000000000000000000000000000000000000000000000000000ba0d0da292bc930f99ab40be60fece6190321d64bba328bf50f388da1e11a7bfa1cb9014000000000000000000000000000000000000000000000000000000000000000200000000000000000000000000000000000000000000000000000000000000100000000000000000000000000000000000000000000000000000000000000000b00000000000000000000000076f2b20a94385fcf7c8bfd79c6bc74db4cd11e59000000000000000000000000166ea4529ae9b7ec27263afe75a8897a805ddb26000000000000000000000000000000000000000000000000000000000000000a00000000000000000000000000000000000000000000000000000000000186a000000000000000000000000000000000000000000000000000000000000000c00000000000000000000000000000000000000000000000000000000000000020000000000000000000000000000000000000000000000000000000000000000cf87b9476f2b20a94385fcf7c8bfd79c6bc74db4cd11e59f863a0a36d418f70010f65a24cd886302ba844b9a6438212d70d947ac1fb4d8f7ea497a0000000000000000000000000000000000000000000000000000000000000000ca0000000000000000000000000000000000000000000000000000000000000000a80';
        bytes memory txIndexRLPEncoded = hex'29';
        uint256 logIndex = 0;
        
        bytes memory messageBytes = hex"000000000000000000000000000000000000000000000000000000000000000b00000000000000000000000076f2b20a94385fcf7c8bfd79c6bc74db4cd11e59000000000000000000000000166ea4529ae9b7ec27263afe75a8897a805ddb26000000000000000000000000000000000000000000000000000000000000000a00000000000000000000000000000000000000000000000000000000000186a000000000000000000000000000000000000000000000000000000000000000c00000000000000000000000000000000000000000000000000000000000000020000000000000000000000000000000000000000000000000000000000000000c";

        targetAmb.executeMessageFromLog(
            srcSlotTxSlotPack,
            messageBytes,
            receiptsRootProof,
            receiptsRoot,
            receiptsProof,
            txIndexRLPEncoded,
            logIndex
        );

        bytes32 messageRoot = keccak256(messageBytes);
        require(targetAmb.messageStatus(messageRoot) == MessageStatus.EXECUTION_SUCCEEDED);
    }
}
