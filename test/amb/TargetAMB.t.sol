pragma solidity 0.8.14;
pragma experimental ABIEncoderV2;

import "forge-std/Vm.sol";
import "forge-std/console.sol";
import "forge-std/Test.sol";
import "./LightClientMock.sol";
import "src/amb/TargetAMB.sol";
import "src/lightclient/libraries/SimpleSerialize.sol";

contract TargetAMBTest is Test {
    LightClientMock lc;
    TargetAMB amb;

    function setUp() public {
        lc = new LightClientMock();
        address lightClientAddress = address(lc);
        address sourceAMBAddress = 0x42793dF05c085187E20aa99104A4E67e21823880;
        amb = new TargetAMB(
            lightClientAddress,
            sourceAMBAddress
        );
        vm.chainId(100);
    }

    function testExecuteMessage() public {
        uint64 sourceSlot = 7725990;
        bytes32 executionRoot = bytes32(0xcb7cd7e3d6fcb9ed019eec76dd8483a7732e5e83b598586afd1308ba1ad9e962);
        lc.setExecutionRoot(sourceSlot, executionRoot);

        bytes[] memory accountProof = new bytes[](8);
        accountProof[0] =
            hex"f90211a0bd22c40d470b1116c36202a184436aa5aab6c00ca1a961900e8e802a71ebc016a0640b6be0b038321db7adb2788ac8d2afa9b82644d1323e9a690a8c8905c84b81a09685b78246e3c4fb28fee6887b05721dd3efeec51e992c0c6cf3ff679ea67659a07cdfb02afbfb361cdcc5cba88e0a773257fac4e477aa08515eb0e7e1700e2acfa0e9efd828dcee422dff33bd46e6364e8dc8aa5af0b76b17c63c40d115f52dfae3a0cfb1e72c4e93b2eeba55cd6564eb7f6c559bbf4c954a389e672ff09c79ffc481a07f2ee1c2c4667331edf0dd1ab8690a881bbd6d68353693abd9bc55938e95cd72a054907b454ef211ed5adf3203a9aa2a9c849ca4baaf58b8f2334648505fba692ca08c93fbe97344f0cf47249647ff7beabfec348061f2c5db8b06b9c6a13cac101ea0abd596736f9913747b2a69f225722d18908dfed5f9419d387dbf0cd3bb3bddaaa0f27a021fb25be936a98a223f3bec33d5a140a74c5f2964b27a62a356f3d3e276a0cec4e89b4dfaf8b154b417e867c3643bb2afb8db60efbdddb0c20f3a840680daa03948666abaa305cb7626aa2c7aa7eb94542397f90f1da9efdbd1ffdbecabff71a0f07a043deea9261111b3a52a447cbbba793bdcea0120e71cd3d41773d7184bcda0b9037b5bbf47b313ce0b1c7fc9cd6f7301ee294afad112d44fc74ed7f868ade6a069c9e1d7fddbace686fce8c137e6bbed47ec66f63744e29d18623ffe60aa556b80";
        accountProof[1] =
            hex"f90211a0eb8689a3af3d3605b0c4d84c938b6c3203689b6134638f72b61cefcaa4de754ea0ed7d0c3edc6c617ea7af84fb656a50b0fbd1fcaf7b53cbb9d5ffdf5709776204a0b6de9b4840d4664aaa0f732f625c8385d485486d5e670fbc1155ec76d69528bca05cd9120ea2694c7d4fe2da43b2fb8377b25778905b5f3d807b885a3521b1a842a05223f018434c4cc725bebc30f93966b2a98392761356fbb99b886f861a632e17a0bdeb5d6958e4a32f819bea257a88af52e66cf8baff573981a916185f9e8f628aa0e0d36008579e4cb8a3de0cfdf388342028c60fd0cfaba41b61a8db96024dd1dba04d353c936a99c43465149b861e0a30cb2c08f2ecb313e7ac645d00fa2b695a1ea0bddcbb4bf6d5b9b3537233cb226157bbdce7d81578f42f228817d925fbe5d1e0a0d419390bdcd6299ffabf3a9c0ed7578049edb83ed700b9889db15a9aa1138708a07ea1ad8c9bcfc39d81370fac138a6c7377024c7f50ffdfbb3d841f018312aed8a03bbc52e2af4c9debb3a111be91443088230df2d8a85c937e6846e20de5ca2ddba07fcc52ac80657a319abb49b884cb684ece2e5df75e246d003688528b50c70754a0dad344da7363136cdc4a6c288e9813de3366ebefbee6b45c4376ca0f2ca1bb02a003d38d3dd3e9a1abd92bc690d395137c9126a4ccf147299fe98037c3fd2d8189a07f4c223d0e3dc8a7e3f7a25495bf658f845f3248db2cbc3297219c47e21aaeae80";
        accountProof[2] =
            hex"f90211a01d1d1a069a7d945cdd59b5d534007b86a0bf442e0b84db821f6a08b9aff50297a02ceea5fdcaef6fe30e23111547e76d23000c2fe61e75a1f49beb6c1b4490d6dca01dc05def808c9c9c817224b23f6501cc7bb3697d2583e4051949e7269198ca6fa09ae840e91873b2261baa0b2a2d22387c6dee64d67a8a33683159b04dcf7f0e79a02923b6ad6afbbf978fa0fd4c9506468ff17842555cf512dd024261b7c4479fd9a0dcefd73d55a4df5bfc6e57b0a14a81d28f691ddb04d8030cbb0fdafc3001406ea088ac07d43f386f3cbd5d7d75ea3e39ef0e9c2d6f37f1d5c9e8b53265bbe9e8fea0b87931ada8c2471a753e2fe8fb8a17a91ab909e52727dcb51a9b70dfb49ed61ca053146e4d5255a14304d7da96cc73aafaa17e675924429ecfa9e3923fc5f0dac2a07a3015774a754be07b396ed971e8b62f1c394adcfddc308ebeb5ef5c35c0de9ba06ab1086ac83c887424d9395c5189520079e09b06bca1a20a8d235b69bb5ce703a09108da53cf102a54091d6f7d7630670d6d41b45caab688201ec48e7b7d40e82da0323015275bcd6a518389c0bb213bf4b81a3516ce2748f49bf98c06987ab314d6a051e41dd6fc1986171f4b625976868b36035b676b0e4ca485828cc92654846001a0702d0f459df4ecf92ad5c3be48757a7c86b1b4f09ccdffa20ecc0b3ab58a5024a056a909d7910f39ef0f1286f892988d56e35da9de9a27b588c105034f48c7d0c080";
        accountProof[3] =
            hex"f90211a0ba3bffbeac1d5f4ce36380494c7eaf06b54a96339b3ceb2178e0809d95460e6ea011612f67916d31b0c77c307395dd038d61c8617f1537df55c9f60819fa122422a01bb3d4e8106be4e549a28c1ca7b7c38e3ead19b14a2e884f72fae35437f98947a0258c7a55a4c628321ede483cd81bdcd1a86ceb87409da94fa626eae75b81babfa071523970a72203b1415f091610354bee24568050c3479d1cd84d3f79cb635fe5a0536ba529ca0822928624371ce6574cd7f80607000df51e5bf58acbdb5d964c5ba070351fee868445dc321a1148879225173e5a0e298aa7cb010ed4aead2cf4c7e0a0837dc8f363b0cd15a3b1602584763767807bdf101e20f624b64454281cdbfc5ca014d73b8a30b13409ff9bbf139e7e3affd87df0ab0dbdff0d3b0e0a7c2e90132ea0ed4a533f3f5adb1c67515b7b990dcbe644819e5f0f097c8b8765d2152a2f14ffa071af248c6244c198010f0772d8d50cbbd00617abebf711393cc50e5ded3fd467a000205353c44ca8fd5cc79715e9270ffb543a30af76a0897083c5a9282597a5e8a0302b41a82e169dbe0cf9830358f676128b62e86040641d123f702a57c60f25e3a07dd5ab6584de223c1677ad440d2938050dd68bf33735c9b3479b206830d7ce5aa05c09779cdccb26244d91fc236a323002f69e13210ef3fe7a87fac854f700a9e7a0ca3b34416c4e45ca98fc458af20d2fbf64d4a3e77e937527e3f9ecdf080138e880";
        accountProof[4] =
            hex"f90211a0537c80d01107b3b8d77c8af13a1aa4977abb5e9432b1e9577b7944ebcb4789b8a03018e9c68f82f2e3e15d7025c36040b59b748641c756e61aa5b707667b4c198ca05490a3c1985b360e81142b9c37c2509d59a8f54fe83f1f62fa3bfe43f1b0e9d3a097425808ba81e3a5bae5af914a3dccff544a8155df31fc975cf4bd305b7e7057a0dd0b1cf013e29fc9308dedff649cb41ffc70aa2aad4f686d697a3fa47cd689cba087ca7df614c0d893d7415130caf3a759b9a3b53a43886e9e488fa9b6c3e575cda09f3138074a674909960c8b6e8a8b64e1a8a2ac294300420bced4dc9008ec4f5da081c19a27e5545118e117cf5375962d7540069b5aa0979655c245a7cf0335dfa6a0e219f7c32fedd932df671dec044efebb04add184a02f636d11528c5ed0960965a051307864184a9b66a7a6888bd2d45dd048ccc6db4a55c6ceedeb4c6bc6cc44bfa00e8c4f9db5a78b8d21b9c97b4afc1c046b63bd5160a08a9aa86f34787db40bb4a00afc75cd5407aeddd084210d94c79d9e8d0752aa9c56ea74c22a3a68f61b3a05a0d0417601a2b7c719bfa1ac4ee5521073e18ee4b0ee0bbf6a7dbc96b4a9994705a09174f245d3ab8f9d18db908319ab3c6b762248287c65648da01164a7a8c00592a023e8196f81d5aed4a40d5e24599816a5a19feae103df5a566b1e66ba631755c7a07b18d7e2bee75214816b93497ab684acce1c9a7fe697fcb56eaddc15c85b6baf80";
        accountProof[5] =
            hex"f9015180a0b3ce95094b35aea747c8190a13462aea43255e4d08a952988f1d97628581efca80a0660135ecdbcbdf53a2198f0333d326bf2fb17960a6000557b227f459f81bfe0380a031b9dcbbcad33c01020599911c1ed757ab6b0d49228a4459bbfa94d80339060da044734df82ae270d87af981475fd23837dabb28a7879739c2f85d924028eee3d080a04da1ed2cf045a616ecaf43ef30bcf419994797bb215a17ff028e23fe2fc9e15ca0b3d8573a66233c6ae754ba61d280f4fc3687c2bdec9fc1735432d5d5cc2d5722a08e6fce89d24ffb3895de7f818d818e10ec056ff6d48e0ad25d3c8a165f1c5d4780a07588e634077653f50807b19f480f04fc85378ed2f4e7f30b00fad2bc8bfd16de80a0bbc62cfd324a6ed22e9c1157079eb6fae88147a5acd3424713380aac12e6f1cba0b8f56f816bcd4e1298d645629b47e4a908eef87ec0e81aee8e90b97e56d3a59080";
        accountProof[6] =
            hex"f851a05b81664230936d2dba284dd9e92270c0b8d877ae8d7636dbba95853c6ac301628080808080a09d6a2409cb5e9c2f88037f1e8da7e2e21bfa53d9f6b8d0111a17779b294d140880808080808080808080";
        accountProof[7] =
            hex"f8669d350a94beda7ef9dafcd2ff222f56afcfc32798df80e8cde4c41ee51569b846f8440180a050fc79aaf670adf9f0adff6a553fac0b733151c49fd644fef58b9e9fcfcd86caa082007db7125c87eb6d034ec37046d93a249333dfef349c8ee9b32c60e4999740";

        bytes[] memory storageProof = new bytes[](3);
        storageProof[0] =
            hex"f8d1a08857639e3944eefb53fc927fd82a371bd6fd6ada8f9fe9cbc2b6381c1aeb5fec808080a09d1bdeb37df185163f327bdb0f417cf2647a05e7039606f486f40acd85e12c3f808080a0604ee4f06b8ea3035e3dcf6528c50e5031f173dbb4bea06460aba082b25d47cb80a064a645f9186d0cd20a1085d7cfc14e82854de25ea3791f659e525cf55c90b88a80a0c04710f5601e4c5dcca343d823f7b00f3fc13d1463a7b4df32dbefdfe1e92c9d8080a0efcbf394e6c7ccec055497aa56de0120b5cc293360a816def7d92183849ab3dd80";
        storageProof[1] =
            hex"f871a0aa52a12c3844bbac64e5555ae459dc59670a9699510aa43a59f11d066cf43de58080a0ac90845931326be2b79fbc687313c008be30b37e70a74583ff4bfc1703c08d7e8080a0199a703f1f0840573ca4690656c439076a2da9e34462724db6a7d6ba66e2a10d80808080808080808080";
        storageProof[2] =
            hex"f843a020df3dcda05b4fbd9c655cde3d5ceb211e019e72ec816e127a59e7195f2cd7f5a1a058eb5267effef0b3d1ebbb7839c3a52db33dec8bd32116e22c9d65ed7df5a2e1";

        bytes memory message =
            hex"00000000000000000000000000000000000000000000000000000000000000000000000000000000000000006e57b45b57e84c964e7cdff596ed02e0387d617e000000000000000000000000efc56627233b02ea95bae7e19f648d7dcd5bb1320000000000000000000000000000000000000000000000000000000000000064000000000000000000000000000000000000000000000000000000000000c35000000000000000000000000000000000000000000000000000000000000000c000000000000000000000000000000000000000000000000000000000000000600000000000000000000000005b73c5498c1e3b4dba84de0f1833c4a029d9051900000000000000000000000000000000000000000000000000000000000000640000000000000000000000000b7108e278c2e77e4e4f5c93d9e5e9a11ac837fc";

        amb.executeMessage(sourceSlot, message, accountProof, storageProof);
    }

    function testReceiptRootProof() public {
        // This tests the receipt root proof against a beacon state root.
        // This tests the case where txSlot and srcSlot are within SLOTS_PER_HISTORICAL_ROOT
        // of each other.
        // The function costs 38k gas.
        bytes32 srcSlotStateRoot = 0x8a971d2c00794efcb266732a1fcf91ae69b78b60d97918e0ba13fe086ac0c68b;
        bytes32[] memory targetSlotStateRootBranch = new bytes32[](27);
        targetSlotStateRootBranch[0] = 0x3c1922a5ea241463bfacfa6e4c55dc63ee235b706cbd972bd549fb5a35211443;
        targetSlotStateRootBranch[1] = 0x58824c5477a7944fb347e955b5f160fd5b9e4578dc3869a8f2faa763bb2f280a;
        targetSlotStateRootBranch[2] = 0xb4ef22a350546b78e23c5b4eb62612a5bbade9edd0952961766abf704f22867e;
        targetSlotStateRootBranch[3] = 0xf461bf759330c4b87849369839057ac181d8f16056e94af94b083ec370c6bd29;
        targetSlotStateRootBranch[4] = 0x0000000000000000000000000000000000000000000000000000000000000000;
        targetSlotStateRootBranch[5] = 0xf5a5fd42d16a20302798ef6ed309979b43003d2320d9f0e8ea9831a92759fb4b;
        targetSlotStateRootBranch[6] = 0xdb56114e00fdd4c1f85c892bf35ac9a89289aaecb1ebd0a96cde606a748b5d71;
        targetSlotStateRootBranch[7] = 0xf4ba75b3557546db48af6a65a4d9c85caae9ed1ed49a2e8e0dc8b5ee16bb6c19;
        targetSlotStateRootBranch[8] = 0x5bc6c323360ba17bab7bc008e42f3b724fdc42a0ecaaca350f7ed9996c7bd2e7;
        targetSlotStateRootBranch[9] = 0xb4ac9b73fea5606f0d6af8202660b0435f88ddd7546f1a4d625a72844250babf;
        targetSlotStateRootBranch[10] = 0x268eba359db6b7a392ef915f3cde9523d533e47efe855258e553121d6f431a18;
        targetSlotStateRootBranch[11] = 0xf374b7407f90e62c78049acb7780d00b4e0728705f1c99bff9ab0f2247bd4f79;
        targetSlotStateRootBranch[12] = 0x889acf0e17b3690d46d8a42b882464fd3a30ff546f5fa6379e1518242fc206ca;
        targetSlotStateRootBranch[13] = 0x387f59eb20a5e1294a65966f944f8c98af497c3d6d77cb5dd0a4973c7b2ed77c;
        targetSlotStateRootBranch[14] = 0x1bd9c412705fd1c99931860d2c23233c6e3775cdbac91ff93c235453267fb732;
        targetSlotStateRootBranch[15] = 0xc596ac89cdd28ba7680b78d53bf4f9edc68dcb1ca1e2854367c1d2db298aa85b;
        targetSlotStateRootBranch[16] = 0x21708bd1258c86451ff99644563018000914da5864639c27c917d1aaee968495;
        targetSlotStateRootBranch[17] = 0xb2d69c5d06778817eb49469fea28edc748ea80ca59309495b2f6ff4e5f07290a;
        targetSlotStateRootBranch[18] = 0x4c7668e400558472d0ee6e8897355ce48c11e6646bdc9097e0ef77dc21f2d358;
        targetSlotStateRootBranch[19] = 0x1d74928552a0db9fed3a5344e0655ab6ba422f12fe95cca98a28d3943b8aee23;
        targetSlotStateRootBranch[20] = 0xa7907a1807ae753e86f018b8096ec68d86b6baf098e1347b2beb7e2cc40cb7ef;
        targetSlotStateRootBranch[21] = 0xcaa0c0d466c382afb754a047d6f8a01420df3f166cef655b43743ad758e33281;
        targetSlotStateRootBranch[22] = 0xc171a2c57d669c2e10eec7af1b8fbbc2da7f518499f90aa2346adb4d84b7e8c7;
        targetSlotStateRootBranch[23] = 0x6a98e7cb86041c8bfef8409a2b0b0687e50e3d5d51ec70d06522578a8bc5d9c4;
        targetSlotStateRootBranch[24] = 0x7a10ae15a283982b2366bf1cc5574a7bbb8ec7b6f724f18537223c8ec1524f08;
        targetSlotStateRootBranch[25] = 0xa788a54ef7abad6ad9188bbca48754dffee3eb19d4de1a083c1324ab24279b52;
        targetSlotStateRootBranch[26] = 0xef9e4f1156c85ace4f2cc7a73029501f0d33ace011b8d1fcb13103ea9acc8475;
        bytes32 receiptsRoot = 0x05911bffdb32343df6d8af53971ade6b8959e1b06ad994715a8080524a2875d2;
        uint256 concatGindex = 162103683;
        bool isValid = SSZ.isValidMerkleBranch(receiptsRoot, concatGindex, targetSlotStateRootBranch, srcSlotStateRoot);
        require(isValid, "Invalid state root");
    }

    function testExecuteMessageFromLogAgainstStateRoot() public {
        // This is for transaction
        // https://goerli.etherscan.io/tx/0x29f2d00f672cfca2ba47d64bae25a5e3c22c964027d7da53d94fc0232b9fee32
        vm.chainId(10);
        uint64 sourceSlot = 4359434;
        bytes32 stateRoot = bytes32(0x7ee9e190b18bbcdf69c5cf923c08ed1d891ad4b92f993bd4bc05cf7a22bf7c64);
        // NOTE: this is actually passing in the state root field of the block header (not the header root)
        // that we normally store. This is the case where we decide to expose the beacon state root field
        // in the header as opposed to the executionStateRoot field that we currently cache.
        lc.setHeader(sourceSlot, stateRoot);
        // We want to use a new targetAMB here with a new srcAMB address
        TargetAMB targetAmb = new TargetAMB(
            address(lc),
            0x9FAC335A6C905346FEb37E679a34b7A8C61A44B1
        );

        uint64 targetSlot = 4359319;
        bytes memory srcSlotTxSlotPack = abi.encode(sourceSlot, targetSlot);

        bytes32[] memory receiptsRootProof = new bytes32[](27);
        receiptsRootProof[0] = 0xb49fcf4424b3011c58125457a9981fb4d9d83d6372335803976c639caa5b4928;
        receiptsRootProof[1] = 0x91fde5c543814c24125decbd109083844eec89e065c6a02179a7c8a4d9d60d18;
        receiptsRootProof[2] = 0x84e780b5256f1c09a011459549c3456bd2ae44451adcb19c5f51d85c34451e3b;
        receiptsRootProof[3] = 0xa576a07fc2e9d9092b6c1eb29aa053d552293b390e7639d0e69827c767d60604;
        receiptsRootProof[4] = 0x0000000000000000000000000000000000000000000000000000000000000000;
        receiptsRootProof[5] = 0xf5a5fd42d16a20302798ef6ed309979b43003d2320d9f0e8ea9831a92759fb4b;
        receiptsRootProof[6] = 0xdb56114e00fdd4c1f85c892bf35ac9a89289aaecb1ebd0a96cde606a748b5d71;
        receiptsRootProof[7] = 0x18256aad9d5981921fa684778ae1ec687fc9239b936801b07fb0dc09f4054c4d;
        receiptsRootProof[8] = 0x74ff037cec48ce41fe17bc2e4469e023d4e207522c23c756a4318bb74108a092;
        receiptsRootProof[9] = 0xaadcdc3a87a572e43970562952c792c236fe5fbbe38666bf0b968f749e1dc03a;
        receiptsRootProof[10] = 0x33e992a750976afbc403122296b21b52b025dd65edfef67b5514549fd6f97405;
        receiptsRootProof[11] = 0x7caa51cc5f884abcd79d70634f42e6e4e6a9a50106b54b649861b1a85a430720;
        receiptsRootProof[12] = 0xe43df2f96d36d1d44cee2de6b16bcc31b3ff1d7aaf0027c6766c8f07535ae469;
        receiptsRootProof[13] = 0xc825e6a064a09b8159b05ce47f09e5555d71b690ad8f47a7c587b1f0241ab1f6;
        receiptsRootProof[14] = 0x99e9f25cdfc3320034f433b536345c68c69a5b6e0cac9cb9b9ea85eef2d7a86e;
        receiptsRootProof[15] = 0x8c4eeea26a67c2f328f22007599e6fb94f96ee719745229bf9c148f36faf8a70;
        receiptsRootProof[16] = 0xdc6bad2725407c3d1be981c2237ac38c9a5fd03b83a9e2e8f07df667f1003836;
        receiptsRootProof[17] = 0x5dc6ee14fe740c0eb23f0ff5fcdc052ec8550b561a3c709db53e69f4b40269c9;
        receiptsRootProof[18] = 0x33e2d3eb99f759a7a2407f2453331f97e20e11ee71b24e59a510094a585edee8;
        receiptsRootProof[19] = 0xa98d07e323ca982a667c4eb35ef3d5c63df0b2c444c69bbbf14884541024e6ab;
        receiptsRootProof[20] = 0x6bba545bb217439227a6c47992710da5b69077ede313ec5dfedcb23d55fc7852;
        receiptsRootProof[21] = 0x85c95ded65e47ba30954ff1949e4ea5dc0df53b2477da29d2dc6ff357f15b7d6;
        receiptsRootProof[22] = 0xdf56dce5a86efca896ca62251898e8cc20444ed333ec13a1758581897cbb8a90;
        receiptsRootProof[23] = 0xf12bf2483c9539301c395511e92e798e464e94703c3b77bc23c9749e7a2a78a7;
        receiptsRootProof[24] = 0x972f8a8e496559da008a0edfac4053fca8fcc37202d90fd5b09c908529de09b2;
        receiptsRootProof[25] = 0x10034b7d9039ade30b90082d9723cec303969d3d197b9989c3e357ff171a8d82;
        receiptsRootProof[26] = 0x325509be92d489e86c094ea2e39ec192e8e4c7ae672ffb39fc9c3a670cffc8c5;
        bytes32 receiptsRoot = 0x35c3509d3520db16370024a4f3ea3faa5210fe73c1ebcada9f70006bf29592b4;
        bytes[] memory receiptsProof = new bytes[](3);
        receiptsProof[0] =
            hex"f8d1a0a9b5e791d1636d13ebaf8a4bd803ccdc62428c65aa720db3c254ba4841b922aba0ca56889f6e908c6a283a95bc9d9e8edafd8a7193f7b014c20af3261d2dddd508a0efa41ed9e4677058d2e4e849e22b9331f2756a860f276aa402faf0c6825611fca064d69ab1c91219dc613f229755498e7cdf2ceed08d30f2b93c3b00d3e5877c7ea0a2a0f42d33e76b544c1f4d65a3f9938fc925e3cfad3876cc87ea7ba962e69096808080a0e58215be848c1293dd381210359d84485553000a82b67410406d183b42adbbdd8080808080808080";
        receiptsProof[1] =
            hex"f90211a0e31de284966365cc1a21555250cf02364b0d1784feb4e7d3d9e1afc123485493a0ba6b0cc12653762889a8bf364523266e977876b8cb1c27e7dbc29778d545928ba052c83c0ce70d0b51865426f261f7801dc545c72802da0af78bd915298d40420da06148ab84431bc63231921d9ad4507f4ad5f7aaffa0f178536f55c95f58946673a023828c1e49ecdbb76261d065c6b6c8a0fc787e02484217067c11a9ae87effa15a0d85f7d12cf61c4cf1684f4632bf55722746ad04824cd464db0a42b8890c4d8a7a079477d4a2cbfa5a92d02bac293b08ce0d6c99712472af188f6eb4b2e347edcb1a0a19eaa4fa5ee24b8e57111e6d2c2a27dac8b214a5103c23f2586ebb3ca67b528a0e3d60cb6c7ef84e674e3d6f97f9ca6f2e341ae09a255762272f84fe1c8863031a05b776f11d256c1076ffcc80a29d507fdc08d281bca80a55107407fabd7aa5aaca0278d8c61b0cdd6a7f638da345b0aaa01e966efebce0a3970305e04f363d810c4a097cd9f32de05dc6ad22bfd5f91027ced78b2da27c33663eb7b613318bf81f45aa05dc538a83faddf36fb3a56dfada8db56afd36c014a6847ea876786bcadca74afa0c00527a625fb965d8e89d96d73a1578e409262eb1e8e7fbd5f712a44f1847c75a0db81b35e65873d6517d4fd305bcb377b8fce818718b2b4f8d61263ba55a3b3e9a045057075f11468500ffb11cca9dacfcadfaa995df8b0b507574a03303f5e8bd080";
        receiptsProof[2] =
            hex"f9035020b9034c02f903480183300999b9010000000000000000000000004000000000000002000000000000000000000000000000800000000200000000000000000020000040040000000020000000000000000000001000000000080000000000000000000000000000000000000000080040000000000000000000000000000000000000000000000000000000000040000000000000000000010000000000000000001000000000000000000000000000000000000004000080000000000000000000000000000000000000000000040000000000000000000000000000000000002000000000000084000000000000200000000000000000000000000100000000000000000000040000000000000000f9023df901bd949fac335a6c905346feb37e679a34b7a8c61a44b1f863a069fba49bf5354b0f1c560ef32d7525874d05e65452e997b5556a9dedb5d7576fa0000000000000000000000000000000000000000000000000000000000000000ba0d0da292bc930f99ab40be60fece6190321d64bba328bf50f388da1e11a7bfa1cb9014000000000000000000000000000000000000000000000000000000000000000200000000000000000000000000000000000000000000000000000000000000100000000000000000000000000000000000000000000000000000000000000000b00000000000000000000000076f2b20a94385fcf7c8bfd79c6bc74db4cd11e59000000000000000000000000166ea4529ae9b7ec27263afe75a8897a805ddb26000000000000000000000000000000000000000000000000000000000000000a00000000000000000000000000000000000000000000000000000000000186a000000000000000000000000000000000000000000000000000000000000000c00000000000000000000000000000000000000000000000000000000000000020000000000000000000000000000000000000000000000000000000000000000cf87b9476f2b20a94385fcf7c8bfd79c6bc74db4cd11e59f863a0a36d418f70010f65a24cd886302ba844b9a6438212d70d947ac1fb4d8f7ea497a0000000000000000000000000000000000000000000000000000000000000000ca0000000000000000000000000000000000000000000000000000000000000000a80";
        bytes memory txIndexRLPEncoded = hex"29";
        uint256 logIndex = 0;

        bytes memory messageBytes =
            hex"000000000000000000000000000000000000000000000000000000000000000b00000000000000000000000076f2b20a94385fcf7c8bfd79c6bc74db4cd11e59000000000000000000000000166ea4529ae9b7ec27263afe75a8897a805ddb26000000000000000000000000000000000000000000000000000000000000000a00000000000000000000000000000000000000000000000000000000000186a000000000000000000000000000000000000000000000000000000000000000c00000000000000000000000000000000000000000000000000000000000000020000000000000000000000000000000000000000000000000000000000000000c";

        targetAmb.executeMessageFromLog(
            srcSlotTxSlotPack, messageBytes, receiptsRootProof, receiptsRoot, receiptsProof, txIndexRLPEncoded, logIndex
        );

        bytes32 messageRoot = keccak256(messageBytes);
        require(targetAmb.messageStatus(messageRoot) == MessageStatus.EXECUTION_SUCCEEDED);
    }

    function testCloseSlotExecuteLogAgainstHeaderRoot() public {
        vm.chainId(137);

        uint64 sourceSlot = 4805856;
        bytes32 headerRoot = bytes32(0x8659a1e07ff91b8e8174cd8392d32f2c9db74f4a9a688921d8168369a095ddd5);
        lc.setHeader(sourceSlot, headerRoot);
        // We want to use a new targetAMB here with a new srcAMB address
        TargetAMB targetAmb = new TargetAMB(
            address(lc),
            0x39323dC5A276553EF7fD16Ed3164175747eB254c
        );

        uint64 targetSlot = 4802050;
        bytes memory srcSlotTxSlotPack = abi.encode(sourceSlot, targetSlot);

        bytes32[] memory receiptsRootProof = new bytes32[](30);
        receiptsRootProof[0] = 0x6d69b4703b5c5b7c5ce193a9c3f8ba636ca6d232b48443f9c4f8e5338afbc6bb;
        receiptsRootProof[1] = 0xe25d4b5118536114816c3d7114f9e588ccaa694139a371c27866bbffbeaaf5d5;
        receiptsRootProof[2] = 0x43bbd1c1dd49640966cecc57d5fba88f059c57940f3b470baee34b5683c3e7cd;
        receiptsRootProof[3] = 0x93b46f685578722bc1f20e0580cea88ba6818cde7e3eacc2991091ef4f93424c;
        receiptsRootProof[4] = 0x0000000000000000000000000000000000000000000000000000000000000000;
        receiptsRootProof[5] = 0xf5a5fd42d16a20302798ef6ed309979b43003d2320d9f0e8ea9831a92759fb4b;
        receiptsRootProof[6] = 0xdb56114e00fdd4c1f85c892bf35ac9a89289aaecb1ebd0a96cde606a748b5d71;
        receiptsRootProof[7] = 0x6d654575390a082a8d6819b448023a30a7176724bf10102bd35de997bd72f835;
        receiptsRootProof[8] = 0x2783ee765dbea6302d642427a56f2afb08b239f8bbfda6cdc2abadc5c685ece2;
        receiptsRootProof[9] = 0x7b1541bcc7566ae345f8b9f07b34acb75c50c3b720a9dd74adf39a3ba3fc297b;
        receiptsRootProof[10] = 0x389600110709a2b7daa807d733241746c8a11998b220887c5062ef0bfcb2c6f3;
        receiptsRootProof[11] = 0xd6d70028ced8706964e6eab091c74dbbce795e1d6cf5cb50f6e9746a9cdeb643;
        receiptsRootProof[12] = 0x2798b413fdfe5b09b84ded2e6483bf7ad20337b4f9b8171db45d1da94c878211;
        receiptsRootProof[13] = 0x5abe8b52ddb9896cf1fec2c765954ab0d15dc237a8fd5a1b48a95e4e58f849f4;
        receiptsRootProof[14] = 0xcbc962d9879506e8ee5225bdae03e6d324ffe418d911ac87b3920201e75241f6;
        receiptsRootProof[15] = 0x11c21b4581875ee3b3ed0b679fa649ad78a37676593a6a657306c2a6a08548cd;
        receiptsRootProof[16] = 0xcf7c32331af28a7a064f84c19bf01763175e8c1cc845063d38d3915fa6b49524;
        receiptsRootProof[17] = 0x4eb646734c0bfca3297d350722b98f85a75d718b8aab10b76748cb2ba5c09eac;
        receiptsRootProof[18] = 0xdb59a87e640fab8dbd0c566905da034ff7478bf37b05dc23c35848c007336019;
        receiptsRootProof[19] = 0x09d8f13e017ffac727fdb3217c692da9250c02ee5621d75797d9aa5acae1c864;
        receiptsRootProof[20] = 0xe256b2b597f06ad300ca713d24f722fc5a75f177ccd3c37218e9714dc96c5559;
        receiptsRootProof[21] = 0x24aba06370bdd0eb5527fe2ae885c2ab481d3f6ce39e7b3f1c8afd842b87317a;
        receiptsRootProof[22] = 0xd1d2af2f2b7fcc845800140ac1eb8e58d7339c15390fc6bc7a568b2c336a7df8;
        receiptsRootProof[23] = 0x102195165ec71f9af8235bacd99556ea6afae223bea8689f7cb009bdcc920910;
        receiptsRootProof[24] = 0x32d0ead055527e8ad5f4141237c600c597ede75e835f864445e86662a276f2b6;
        receiptsRootProof[25] = 0x77c3e00115a29885f9ddc07b4794c1c37b53066a94f745f078155d9d36969044;
        receiptsRootProof[26] = 0x6b428387b75e469988064675946cd43c70430b9be3c82f52d96bbb49bcbe8b13;
        receiptsRootProof[27] = 0xaaafef0f78c3ce773544fb997687e9157a98364a6c669e7af58a0768bc28c944;
        receiptsRootProof[28] = 0xc63fd0837ab65cdc41ca0cc4e084a4c49d4577d06b13d023d41b501a6281ce74;
        receiptsRootProof[29] = 0xab5ede5b5a84a950c4daf65271f44e7aa953d59fd489242d85b16882786a2955;
        bytes32 receiptsRoot = 0x420e4a1fb5de06660e496f211f301714c9f02819cabad383a35ab443107e4510;
        bytes[] memory receiptsProof = new bytes[](3);
        receiptsProof[0] =
            hex"f8f1a0c173a04148ab69dcab69e5546d525915e40f2fe4638d34dcb10ddda9b3f1cd99a022cc9dc0878be85860378c6ac0ca0ae95b9b608a3e8d57fc1cb89111152a6361a0acf64762d488a97977ac2a3471cc34af6eceaa5ca3eb10b2ec44afcc88695e49a0c59589389433b6cec3e0033e7df457147bf5140d6935fdfa89b145ef390528b2a0cb0f08006b0fbfaea51fa0330452fd709181708764a5605ec191532b7ca3b0c7a03374e20938010f560e2c3c6e3edaa42a4a04aaa402acd9144ef6369b89589cf38080a0e58215be848c1293dd381210359d84485553000a82b67410406d183b42adbbdd8080808080808080";
        receiptsProof[1] =
            hex"f90211a061a9d6ac5eb51ebf91c7199707e914a4b4084a066342f2ca2761853888c8a766a07a2258069475cd6b2eb31016a3e88196fa32817ca4a27c9333b6dc10b3d024b1a08317b8355a6ded15fbdbcb55f8e19ee4763b8b57b18a8611c107e35f8f047443a0549bc29183763349f550fde748598c1bf4793149b33379b0283dba7c83bbaf39a08ab5ef3c16a2f579874d88f36a42745c08a9cdf84a6b3bdbdd25e9ccedc1720fa0c1332fce1f878c14af700cce0fa88b4e8c1bb69bb3774075f889b43798aa4fe7a0b697e71a6bf62fc93dc36ed609035861501e4140f04784a154a3439407eb91c8a0f6ff432d592a3b30bd88597273de1a12f8ad9c4527f3d2807e0f5dab7483f3c1a04b1564322985f5310dc23ad77bce3650c8fcea67506a98be49cdd150ebfc1cdca02fff05fe66d67c354638ea10b0dae6adf6e83f1c9d535c215d0a2953d50b4c9ca0a6cead8c72d73a8450185e76b9e3602f2246ace2eb13f747fa5d710c575f9aafa0a605cf3c3ef7021a2b03eddf7a7dabb89fd79ddc50f587d17159f78ea8fc6473a01c9d765da0e32f5a21de7cfa2be1e5e0a73c907159e3e50f729f979768784078a081fb499707df534ac069e599536f7760d20c13142d3bd6b7ee3658ebdf0a3755a0099cfd1917fd70c88e37cd5a438937b8aa2ae3579bc969376677e070c13ff7c0a0d5e8b87a86a69cadea02f1e14536d47adfe5ba256fd8c35e18e09cc88d187def80";
        receiptsProof[2] =
            hex"f9052b20b9052702f9052301833d819cb9010000040010000000000000000000000000020000000000000000000000000000000000800000000000000000000000000020000000000000080000000000200000000000000840000000000008000000000400000004000000000018000000800000000000000080000000000000000000000000000000000000040030000000000004000000000000000000000000000000401080000000400000000000000000020000000000000000000000000400000000100000000000000000000000000000000002020000000000000008000000000000000040000000000000000000000010000000000000000000000000000000000200000000000000000000000000f90418f89b94a527e520b90163a120988b0fed34ce451adeb7acf863a08c5be1e5ebec7d5bd14f71427d1e84f3dd0314c0f7b2291e5b200ac8c7c3b925a0000000000000000000000000dc42d311ba3a731819562d54b7aaf83b77c857bba0000000000000000000000000539b8ceed8be22edb66fe8135249d524ab551795a00000000000000000000000000000000000000000000000000000000000000000f89b94a527e520b90163a120988b0fed34ce451adeb7acf863a0ddf252ad1be2c89b69c2b068fc378daa952ba7f163c4a11628f55a4df523b3efa0000000000000000000000000dc42d311ba3a731819562d54b7aaf83b77c857bba0000000000000000000000000539b8ceed8be22edb66fe8135249d524ab551795a00000000000000000000000000000000000000000000000000de0b6b3a7640000f901fd9439323dc5a276553ef7fd16ed3164175747eb254cf863a069fba49bf5354b0f1c560ef32d7525874d05e65452e997b5556a9dedb5d7576fa00000000000000000000000000000000000000000000000000000000000009ec7a0958b461e0de4f9f92673bb2267ed85b0264dbdee038598c4ff70ea17b7de2584b90180000000000000000000000000000000000000000000000000000000000000002000000000000000000000000000000000000000000000000000000000000001400000000000000000000000000000000000000000000000000000000000009ec7000000000000000000000000539b8ceed8be22edb66fe8135249d524ab551795000000000000000000000000010ae09c226f0bd12bb42a3e923a2554717d4a500000000000000000000000000000000000000000000000000000000000000089000000000000000000000000000000000000000000000000000000000000c35000000000000000000000000000000000000000000000000000000000000000c00000000000000000000000000000000000000000000000000000000000000060000000000000000000000000dc42d311ba3a731819562d54b7aaf83b77c857bb0000000000000000000000000000000000000000000000000de0b6b3a7640000000000000000000000000000a527e520b90163a120988b0fed34ce451adeb7acf8dc94539b8ceed8be22edb66fe8135249d524ab551795f863a054794d573cf2682871b92123384fe6b982fd0a2fec4130006ef8ec7f4bc0d0e6a0000000000000000000000000dc42d311ba3a731819562d54b7aaf83b77c857bba0000000000000000000000000dc42d311ba3a731819562d54b7aaf83b77c857bbb8600000000000000000000000000000000000000000000000000de0b6b3a7640000000000000000000000000000a527e520b90163a120988b0fed34ce451adeb7ac0000000000000000000000000000000000000000000000000000000000000089";
        bytes memory txIndexRLPEncoded = hex"34";
        uint256 logIndex = 2;

        bytes memory messageBytes =
            hex"0000000000000000000000000000000000000000000000000000000000009ec7000000000000000000000000539b8ceed8be22edb66fe8135249d524ab551795000000000000000000000000010ae09c226f0bd12bb42a3e923a2554717d4a500000000000000000000000000000000000000000000000000000000000000089000000000000000000000000000000000000000000000000000000000000c35000000000000000000000000000000000000000000000000000000000000000c00000000000000000000000000000000000000000000000000000000000000060000000000000000000000000dc42d311ba3a731819562d54b7aaf83b77c857bb0000000000000000000000000000000000000000000000000de0b6b3a7640000000000000000000000000000a527e520b90163a120988b0fed34ce451adeb7ac";

        targetAmb.executeMessageFromLog(
            srcSlotTxSlotPack, messageBytes, receiptsRootProof, receiptsRoot, receiptsProof, txIndexRLPEncoded, logIndex
        );

        bytes32 messageRoot = keccak256(messageBytes);
        require(targetAmb.messageStatus(messageRoot) == MessageStatus.EXECUTION_SUCCEEDED);
    }

    function testFarApartSlotExecuteLogAgainstHeaderRoot() public {
        // Goerli transaction 0x2e5713b62ccbb51b923cd4ffa5a10c5a58deded47d6f7e46e398f1d3cd3ba705
        vm.chainId(100);

        uint64 sourceSlot = 4802400;
        bytes32 headerRoot = bytes32(0x79bb25364c6ba5d8c0c64fbd5ac36572e1e4ff5246f112dd1a63728663a472a9);
        lc.setHeader(sourceSlot, headerRoot);
        // We want to use a new targetAMB here with a new srcAMB address
        TargetAMB targetAmb = new TargetAMB(
            address(lc),
            0x39323dC5A276553EF7fD16Ed3164175747eB254c
        );

        uint64 targetSlot = 4787448;
        bytes memory srcSlotTxSlotPack = abi.encode(sourceSlot, targetSlot);

        bytes32[] memory receiptsRootProof = new bytes32[](56);
        receiptsRootProof[0] = 0x2c4b9576bc033ca20b545f471c0f47d120a4f6d26e067210f70465f376dcfea7;
        receiptsRootProof[1] = 0xed8049b4e96fafd2732fd2ab1e26ef30541466014439248e94f51d7ca290d521;
        receiptsRootProof[2] = 0xdb035a5ec986c8bc21139fa765450c90f44c573132fbbb57e11158f7279cde98;
        receiptsRootProof[3] = 0xcb9047e18c68fcd10fe9eae7071608ca22f12e3699f88adad4d362a0bcc25d34;
        receiptsRootProof[4] = 0x0000000000000000000000000000000000000000000000000000000000000000;
        receiptsRootProof[5] = 0xf5a5fd42d16a20302798ef6ed309979b43003d2320d9f0e8ea9831a92759fb4b;
        receiptsRootProof[6] = 0xdb56114e00fdd4c1f85c892bf35ac9a89289aaecb1ebd0a96cde606a748b5d71;
        receiptsRootProof[7] = 0xa168cbf52d0eb480260d06f869940024fef489dd47f842fa22f3a03ecf08b9aa;
        receiptsRootProof[8] = 0x89898c507d686f005105269e5c74a6beb36c322c40e11c30c5fa5f07cdda5ce0;
        receiptsRootProof[9] = 0x7d569b56d028f37a7d6a44beaa01957a7b880994837ab3b0e2fbc91e438edc59;
        receiptsRootProof[10] = 0x0ed870ecc307bb8a850233221e390cdc3efbd683f84ac58cfb3eec10d22f99cd;
        receiptsRootProof[11] = 0xfd9c88c480d6a75e183bdfe0bd296af4ec07a3db2256c1cdc8ab78ea17084d89;
        receiptsRootProof[12] = 0xbf3106ea369419e4137a62e675faf56402ecb3ef7df6e5af049c92ad587e18ae;
        receiptsRootProof[13] = 0xe197283603b250ef86edf050e971f922648e0d1e6dfe956749d7f658aa6a89d0;
        receiptsRootProof[14] = 0xd262e8eb37f9aeaa617d236bfc961c61b35b9fcd1071cfb35dbc0f5ab02bb589;
        receiptsRootProof[15] = 0xaf2b5bac17f2ce9fba53d7c16b02e05ca0ebbd6e53bfb78266804bdf83e53c65;
        receiptsRootProof[16] = 0x277cf75924396af7452c7c1c532b8e68eaa657cec21fa550c5c8e1db222917fd;
        receiptsRootProof[17] = 0x1c9671bba5a81470f54097b201ce26bbc94533c7898c63116d94aaa236c7520d;
        receiptsRootProof[18] = 0x2d05a0327a509515b402f640fe6afda37a34a50aa5ba78925ac36e5fcd84b49a;
        receiptsRootProof[19] = 0x7f0003c9d9c3ce8bf0abc886d9066bfeabf255cc6ea20f9577372b599eeac4bf;
        receiptsRootProof[20] = 0x38277908536ee380aebdd44cad0c23522311c5e2c0047258ed96c1c8123a77f3;
        receiptsRootProof[21] = 0xc45bd8154db2914e7277ef77601b222713c86798738b222d26eddc30d91498d9;
        receiptsRootProof[22] = 0x79d8dd6308074f34a489b2547db14d614c7d89d3dfbcc97df6895ac0a97e9a79;
        receiptsRootProof[23] = 0xe4f8275fecae88ef7e2ae8c8a79147b0162b33ec41e8132ce309a1b27d4c8ae7;
        receiptsRootProof[24] = 0xf5a5fd42d16a20302798ef6ed309979b43003d2320d9f0e8ea9831a92759fb4b;
        receiptsRootProof[25] = 0xdb56114e00fdd4c1f85c892bf35ac9a89289aaecb1ebd0a96cde606a748b5d71;
        receiptsRootProof[26] = 0x4e4bd13d9cdb92bb7510edfe5bd5c57dd3124060e4a2659831e64dea02ced8ee;
        receiptsRootProof[27] = 0x536d98837f2dd165a55d5eeae91485954472d56f246df256bf3cae19352a123c;
        receiptsRootProof[28] = 0x9efde052aa15429fae05bad4d0b1d7c64da64d03d7a1854a588c2cb8430c0d30;
        receiptsRootProof[29] = 0xe5407aa25ebcdab80cd9eb88e5b2e48c23e44ac3944579c033ae41648d065107;
        receiptsRootProof[30] = 0x87eb0ddba57e35f6d286673802a4af5975e22506c7cf4c64bb6be5ee11527f2c;
        receiptsRootProof[31] = 0x26846476fd5fc54a5d43385167c95144f2643f533cc85bb9d16b782f8d7db193;
        receiptsRootProof[32] = 0x78f5dadc2d6f4ee31b3359539f7de697e0c7b000f76b180056c616995b0f5c15;
        receiptsRootProof[33] = 0xffff0ad7e659772f9534c195c815efc4014ef1e1daed4404c06385d11192e92b;
        receiptsRootProof[34] = 0x6cf04127db05441cd833107a52be852868890e4317e6a02ab47683aa75964220;
        receiptsRootProof[35] = 0xb7d05f875f140027ef5118a2247bbb84ce8f2f0f1123623085daf7960c329f5f;
        receiptsRootProof[36] = 0xdf6af5f5bbdb6be9ef8aa618e4bf8073960867171e29676f8b284dea6a08a85e;
        receiptsRootProof[37] = 0xb58d900f5e182e3c50ef74969ea16c7726c549757cc23523c369587da7293784;
        receiptsRootProof[38] = 0xd49a7502ffcfb0340b1d7885688500ca308161a7f96b62df9d083b71fcc8f2bb;
        receiptsRootProof[39] = 0x8fe6b1689256c0d385f42f5bbe2027a22c1996e110ba97c171d3e5948de92beb;
        receiptsRootProof[40] = 0x8d0d63c39ebade8509e0ae3c9c3876fb5fa112be18f905ecacfecb92057603ab;
        receiptsRootProof[41] = 0x95eec8b2e541cad4e91de38385f2e046619f54496c2382cb6cacd5b98c26f5a4;
        receiptsRootProof[42] = 0xf893e908917775b62bff23294dbbe3a1cd8e6cc1c35b4801887b646a6f81f17f;
        receiptsRootProof[43] = 0xcddba7b592e3133393c16194fac7431abf2f5485ed711db282183c819e08ebaa;
        receiptsRootProof[44] = 0x8a8d7fe3af8caa085a7639a832001457dfb9128a8061142ad0335629ff23ff9c;
        receiptsRootProof[45] = 0xfeb3c337d7a51a6fbf00b9e34c52e1c9195c969bd4e7a0bfd51d5c5bed9c1167;
        receiptsRootProof[46] = 0xe71f0aa83cc32edfbefa9f4d3e0174ca85182eec9f3a09f6a6c0df6377a510d7;
        receiptsRootProof[47] = 0x4a02000000000000000000000000000000000000000000000000000000000000;
        receiptsRootProof[48] = 0xfb23c807ea77b94d1aa1480768800e0aa859ba31bbc40f65e567030146ff29f0;
        receiptsRootProof[49] = 0x952fcc280bd27379cdbd98cbe50f1f5cc16423c29bb7006d7e64196bd5eaeae3;
        receiptsRootProof[50] = 0x60649728496518f7a5cf004c12520f0b70933a0b60d059ff75746a7c3aa80a71;
        receiptsRootProof[51] = 0x3614c18477fa0cc4c574d174a6ff0bb9cde6c476a3879d5412050598eaf3e03e;
        receiptsRootProof[52] = 0x07d4333abc3b6c376892be2ab4409dcbbb89c25880e96bec4b63ee424d4454e6;
        receiptsRootProof[53] = 0xc36b2873544748f6cc48593705d702f28b25f6a7657e8722fb919a1f11d7dc5e;
        receiptsRootProof[54] = 0x98a9f1a18ee31b5ad473bd5da692b9b44ff169da404311757c02ee28b25a9239;
        receiptsRootProof[55] = 0xcceffe047cec63fa641afc7a0037f5a464ce2a3ad69acd19f83bf62580261fc2;
        bytes32 receiptsRoot = 0x282c84d1464fcd1a31e0ead3136b3b8ee1a78cbac61050a771edda7e7d32b036;
        bytes[] memory receiptsProof = new bytes[](3);
        receiptsProof[0] =
            hex"f8f1a0ff6183eaf9da637a9753a4c236ecf0e5caf8f71d8839d02d4155c7e35bff0d59a0abc0f6ad20c0117d9f747a31aaec6bd62a21db4ece9647ce46e96b40be595dcaa04d4c35b6964fcdd075030c0ba808b20d6687cf47cd472cc0a2adace9f7f2af19a0c5e751936694c76711621acdc0ba8d11c3b41702fd61eef0522441bc3a2d5410a0dcf32eec8cee36e3e3a72178e75862132a6c803601fbe1c225f3e47e86e1c863a0c9e696fcae1c927c2ec000e126ded58d909ccce502c7364bddef3f16e7030bb88080a0e58215be848c1293dd381210359d84485553000a82b67410406d183b42adbbdd8080808080808080";
        receiptsProof[1] =
            hex"f90211a039c780afaede6a9965393f2184dda2a3f68602cfc7d225833ae7ec922e17425ca0b125775461a392973a2500af4ec481c321e512edc4a7a85dff197ed80b00a616a0f5415f27872b18cdb5167b2de8bd0399ec432be8afe2e39bef548139c20567a0a05b7fde91721170445844dbf50b87c2943ccab36ef99cfadbe7c3e8ce29d9c5eea0b2837a17a5e66fa1a14c73a09dcca80f1dc8e53b4f39b4f734271ab88f1bff9ea01f145a4617bad2d93b78f5771412837e76f130a512f7d8b6d2ac8ce424620333a045b4898ca009e376f96f4e908d9fcd02653cfa2b32ac0bf4a66d7a16b989367ba0bd1603bfb8982b72ef7bd825c53516b23fd477f6dd4095fa2738a696a845d1a8a004a6e62ef90293ef9fee5d909086c7afd13c8d060ea2528a26cdc132981b88b8a0824dcd4e03055cf14626d4e065412f1d4b249e6a99f8fcfcf64025084461d38da06d17721645fd61b6faf5334c5d00a230a8d552b92c070dda1e1578df0fc1fe75a0cebfc612191820eacffe30f2198e283189a20c3bf705d1cb1ba196d00175aa66a05aa1056070d8b335c5c5732cbd399d20beda6a2d207e41f9fc2ff5b879d19d33a0e7eca24845650b261ee60b73a2143cd899fa490d4994f030dab97dcffdae1c8ba0f41bcc946fef624cc4c8f54c935a954ea2ae58d40133f7f61172038d27c9c412a036a6049e5dc01f3a9d08ec3ce07be13c684954c6fff735f8f44f0be037dca84b80";
        receiptsProof[2] =
            hex"f9052b20b9052702f9052301836048d6b9010000000010000000000000000000000000020000000000000000000000000000000000800000000000000000000000000020000000000000000000000000200000000000000842000000000008000000000400000000000000000008000000800000004000080000001000000000000000000000000000000000040010000020000004000000000000000000004000000000401080000000400000000000000000020000000000000000000000002400000000000000000000010000000000000000000002020000000000000008000000000000000000000000000000000000000010000000000000000000000000000000000000000000000000000000000004f90418f89b94a527e520b90163a120988b0fed34ce451adeb7acf863a08c5be1e5ebec7d5bd14f71427d1e84f3dd0314c0f7b2291e5b200ac8c7c3b925a00000000000000000000000003afb5ec38dc42d310e4552f19da56b13dc2ff8fca0000000000000000000000000539b8ceed8be22edb66fe8135249d524ab551795a00000000000000000000000000000000000000000000000000000000000000000f89b94a527e520b90163a120988b0fed34ce451adeb7acf863a0ddf252ad1be2c89b69c2b068fc378daa952ba7f163c4a11628f55a4df523b3efa00000000000000000000000003afb5ec38dc42d310e4552f19da56b13dc2ff8fca0000000000000000000000000539b8ceed8be22edb66fe8135249d524ab551795a00000000000000000000000000000000000000000000000000000000000000000f901fd9439323dc5a276553ef7fd16ed3164175747eb254cf863a069fba49bf5354b0f1c560ef32d7525874d05e65452e997b5556a9dedb5d7576fa00000000000000000000000000000000000000000000000000000000000009be7a00c20737cdb1886ff5ad3958d1c5395c153a2e13747c594d2ea1c2badb3b11ebab90180000000000000000000000000000000000000000000000000000000000000002000000000000000000000000000000000000000000000000000000000000001400000000000000000000000000000000000000000000000000000000000009be7000000000000000000000000539b8ceed8be22edb66fe8135249d524ab551795000000000000000000000000010ae09c226f0bd12bb42a3e923a2554717d4a500000000000000000000000000000000000000000000000000000000000000064000000000000000000000000000000000000000000000000000000000000c35000000000000000000000000000000000000000000000000000000000000000c000000000000000000000000000000000000000000000000000000000000000600000000000000000000000003afb5ec38dc42d310e4552f19da56b13dc2ff8fc0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000a527e520b90163a120988b0fed34ce451adeb7acf8dc94539b8ceed8be22edb66fe8135249d524ab551795f863a054794d573cf2682871b92123384fe6b982fd0a2fec4130006ef8ec7f4bc0d0e6a00000000000000000000000003afb5ec38dc42d310e4552f19da56b13dc2ff8fca00000000000000000000000003afb5ec38dc42d310e4552f19da56b13dc2ff8fcb8600000000000000000000000000000000000000000000000000000000000000000000000000000000000000000a527e520b90163a120988b0fed34ce451adeb7ac0000000000000000000000000000000000000000000000000000000000000064";
        bytes memory txIndexRLPEncoded = hex"31";
        uint256 logIndex = 2;

        bytes memory messageBytes =
            hex"0000000000000000000000000000000000000000000000000000000000009be7000000000000000000000000539b8ceed8be22edb66fe8135249d524ab551795000000000000000000000000010ae09c226f0bd12bb42a3e923a2554717d4a500000000000000000000000000000000000000000000000000000000000000064000000000000000000000000000000000000000000000000000000000000c35000000000000000000000000000000000000000000000000000000000000000c000000000000000000000000000000000000000000000000000000000000000600000000000000000000000003afb5ec38dc42d310e4552f19da56b13dc2ff8fc0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000a527e520b90163a120988b0fed34ce451adeb7ac";

        targetAmb.executeMessageFromLog(
            srcSlotTxSlotPack, messageBytes, receiptsRootProof, receiptsRoot, receiptsProof, txIndexRLPEncoded, logIndex
        );

        bytes32 messageRoot = keccak256(messageBytes);
        require(targetAmb.messageStatus(messageRoot) == MessageStatus.EXECUTION_SUCCEEDED);
    }
}
